<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cubyz Server List</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #121212;
      color: #f0f0f0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      background-color: #1e1e1e;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
      max-width: 600px;
      width: 100%;
    }

    h1 {
      font-size: 2rem;
      color: #82aaff;
      text-align: center;
      margin-bottom: 20px;
    }

    .server {
      background-color: #2c2c2c;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-family: monospace;
      white-space: pre-wrap;
    }

    .online {
      color: #66ff66;
    }

    .offline {
      color: #ff5370;
    }

    .outdated {
      color: #ffcb6b;
    }

    .loading, .error {
      color: #ff5370;
      font-style: italic;
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Cubyz Server List</h1>
    <div id="servers-container" class="loading">Loading...</div>
  </div>
<script>
  const API_URL = 'https://semiacademic-loni-unseducibly.ngrok-free.dev/servers.json';
  const CURRENT_SCRIPT_VERSION = '1.1';

  async function fetchServerData() {
    try {
      const response = await fetch(API_URL, {
        headers: { 'ngrok-skip-browser-warning': 'true' }
      });
      if (!response.ok) throw new Error(`HTTP error: ${response.status}`);

      const servers = await response.json();
      const container = document.getElementById('servers-container');
      container.classList.remove('loading', 'error');
      container.innerHTML = '';

      if (!servers || Object.keys(servers).length === 0) {
        container.textContent = 'No servers reporting data.';
        return;
      }

      const now = Date.now() / 1000;

      for (const [serverId, info] of Object.entries(servers)) {
        const div = document.createElement('div');
        div.classList.add('server');

        const secondsSinceUpdate = now - (info.timestamp || 0);
        const isOffline = secondsSinceUpdate > 15;

        const playersList = info.players?.length > 0
          ? info.players.join(', ')
          : 'No players online';

        const isOutdated = !info.script_version || info.script_version !== CURRENT_SCRIPT_VERSION;

        let statusHTML = `<span class="${isOffline ? 'offline' : 'online'}">(${isOffline ? 'Offline' : 'Online'})</span>`;
        if (!isOffline && isOutdated) {
          statusHTML += ` <span class="outdated">(Needs Script Update)</span>`;
        }

        div.innerHTML = `
          <h2>${serverId} ${statusHTML}</h2>
          <p><strong>Gamemode:</strong> ${info.gamemode ?? 'Unknown'}</p> <!-- âœ… NEW LINE -->
          <p><strong>Players online:</strong> ${isOffline ? '0' : info.player_count}</p>
          <p><strong>Players:</strong> ${isOffline ? 'N/A' : playersList}</p>
          <p><strong>Deaths (fall):</strong> ${info.death_count ?? 0}</p>
        `;

        container.appendChild(div);
      }
    } catch (err) {
      const container = document.getElementById('servers-container');
      container.classList.add('error');
      container.textContent = 'Error fetching server data.';
      console.error(err);
    }
  }

  fetchServerData();
  setInterval(fetchServerData, 10000);
</script>
</body>
</html>
